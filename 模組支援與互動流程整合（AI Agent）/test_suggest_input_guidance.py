import requests

url = "http://localhost:8000/agent/suggest_input_guidance/"

# æ¸¬è©¦æ¸…å–®ï¼šæ¯ç­†åŒ…å«è¼¸å…¥å¥ã€é æœŸguidanceé—œéµå­—æ¸…å–®ã€é æœŸåˆ†é¡level
test_cases = [
    ("æˆ‘ä¸åƒè¾£", ["æ¸…çˆ½", "æ¹¯å“", "æ’é™¤"], "é£²é£Ÿåå¥½"),
    ("æˆ‘ä¸åƒç‰›", ["ç‰›", "æ’é™¤"], "é£²é£Ÿåå¥½"),
    ("æµ·é®®éæ•", ["æµ·é®®", "æ’é™¤"], "é£²é£Ÿåå¥½"),
    ("æˆ‘åƒç´ ", ["ç´ é£Ÿ", "è”¬é£Ÿ"], "é£²é£Ÿåå¥½"),
    ("æœ‹å‹èšé¤", ["æœ‹å‹", "èšæœƒ", "å¤šäºº"], "ç”¨é¤å ´åˆ"),
    ("å®¶äººåƒé£¯", ["å®¶åº­", "å¤šäºº", "å¯¬æ•"], "ç”¨é¤å ´åˆ"),
    ("ä»Šå¤©æ˜¯ç´„æœƒ", ["ç´„æœƒ", "æ°£æ°›", "å’–å•¡å»³"], "ç”¨é¤å ´åˆ"),
    ("æœ‰é»å•†å‹™éœ€æ±‚", ["æ­£å¼", "ç©©é‡", "é«˜è©•åƒ¹"], "ç”¨é¤å ´åˆ"),
    ("è¦å¹«æœ‹å‹æ…¶ç”Ÿ", ["æ…¶ç”Ÿ", "æ°£æ°›", "åŒ…å»‚"], "ç”¨é¤å ´åˆ"),
    ("è¦å¸¶å°å­©ä¸€èµ·åƒ", ["å°å­©", "å…’ç«¥", "è¦ªå­"], "ç”¨é¤å ´åˆ"),
    ("è¦è«‹é•·è¼©åƒé£¯", ["é•·è¼©", "å®¶åº­", "å®‰éœ"], "ç”¨é¤å ´åˆ"),
    ("æƒ³æ‰¾ä¾¿å®œçš„é¤å»³", ["ä¾¿å®œ", "å¹³åƒ¹", "ä¸è²´"], "é ç®—"),
    ("ä¾†é»é«˜ç´šçš„", ["é«˜ç´š", "é«˜ç«¯", "ç²¾ç·»"], "é ç®—"),
    ("æƒ³åƒå®µå¤œ", ["å®µå¤œ", "æ·±å¤œ"], "æ™‚æ®µ"),
    ("æ—©åˆé¤æœ‰æ¨è–¦å—", ["æ—©åˆé¤"], "æ™‚æ®µ"),
    ("æœ‰æ¨è–¦çš„æ—©é¤å—", ["æ—©é¤"], "æ™‚æ®µ"),
    ("æƒ³åƒç”œé»", ["ç”œé»"], "æ–™ç†é¡å‹"),
    ("æ‹‰éºµå¥½å—", ["æ‹‰éºµ", "æ—¥å¼"], "æ–™ç†é¡å‹"),
    ("æœ€è¿‘å¾ˆæƒ³åƒéŸ“å¼", ["éŸ“å¼"], "æ–™ç†é¡å‹"),
    ("ä¸­å¼é¤å»³æ¨è–¦", ["ä¸­å¼"], "æ–™ç†é¡å‹"),
    ("ç¾©å¤§åˆ©éºµå¥½åƒå—", ["ç¾©å¤§åˆ©éºµ", "ç¾©å¼"], "æ–™ç†é¡å‹"),
    ("æƒ³åƒæ¼¢å ¡", ["æ¼¢å ¡", "ç¾å¼"], "æ–™ç†é¡å‹"),
    ("ä»Šå¤©åƒä¸å¤š", ["è¼•é£Ÿ", "æ—©åˆé¤"], "é£²é£Ÿç‹€æ…‹"),
    ("æˆ‘è¶•æ™‚é–“", ["å¿«é€Ÿ", "å¤–å¸¶"], "é£²é£Ÿç‹€æ…‹"),
    ("å¤©æ°£å†·æƒ³åƒç†±çš„", ["æ¹¯å“", "ç«é‹", "ç†±"], "é£²é£Ÿç‹€æ…‹"),
    ("ä»Šå¤©æƒ³åƒè¾£çš„", ["è¾£", "éº»è¾£", "å·èœ"], "é£²é£Ÿç‹€æ…‹"),
    ("æƒ³åƒæ¸…æ·¡çš„", ["æ¸…æ·¡", "æ¸…çˆ½", "æ¹¯å“"], "é£²é£Ÿç‹€æ…‹"),
    ("ä¸è¦ç«é‹", ["æ’é™¤"], "æ’é™¤èªå¥"),
    ("ä¸æƒ³åƒéŸ“å¼", ["æ’é™¤", "éŸ“å¼"], "æ’é™¤èªå¥"),
    ("éš¨ä¾¿", ["å»ºè­°", "è¼¸å…¥"], "å…¶ä»–"),  # fallback
]

success_count = 0
fail_count = 0
failed_cases = []

print("\nğŸ¯ é–‹å§‹æ¸¬è©¦ SuggestInputGuidanceView...\n")

for idx, (text, expected_keywords, expected_level) in enumerate(test_cases, 1):
    try:
        response = requests.post(url, json={"text": text})
        result_json = response.json()
        guidance = result_json.get("guidance", "")
        level = result_json.get("level", "ç„¡")

        guidance_ok = any(keyword in guidance for keyword in expected_keywords)
        level_ok = level == expected_level

        print(f"ğŸ§ª æ¸¬è©¦ {idx:2}: {text}")
        print(f"ğŸ“¥ å›å‚³å…§å®¹: guidance='{guidance}', level='{level}'")

        if guidance_ok and level_ok:
            print("âœ… çµæœï¼šâœ”ï¸ é€šé\n")
            success_count += 1
        else:
            print(f"âŒ çµæœï¼šâŒ å¤±æ•—")
            if not guidance_ok:
                print(f"   â›” guidance æœªåŒ…å«æœŸæœ›é—œéµè©ï¼š{expected_keywords}")
            if not level_ok:
                print(f"   â›” level éŒ¯èª¤ï¼Œé æœŸï¼š{expected_level}ï¼Œå¯¦éš›ï¼š{level}")
            print()
            fail_count += 1
            failed_cases.append((text, guidance, level, expected_keywords, expected_level))

    except Exception as e:
        print(f"âŒ æ¸¬è©¦éŒ¯èª¤ï¼š{e}\n")
        fail_count += 1

print("ğŸ“Š æ¸¬è©¦ç¸½çµ")
print(f"âœ”ï¸ é€šéæ•¸é‡ï¼š{success_count}")
print(f"âŒ å¤±æ•—æ•¸é‡ï¼š{fail_count}")

if failed_cases:
    print("\nğŸ“Œ å¤±æ•—æ¡ˆä¾‹å½™æ•´ï¼š")
    for text, guidance, level, expected_keywords, expected_level in failed_cases:
        print(f"- æ¸¬è©¦è¼¸å…¥ï¼š{text}")
        print(f"  guidance å›å‚³ï¼š{guidance}")
        print(f"  level å›å‚³ï¼š{level}")
        print(f"  guidance æ‡‰å«é—œéµè©ï¼š{expected_keywords}")
        print(f"  é æœŸåˆ†é¡ï¼š{expected_level}\n")